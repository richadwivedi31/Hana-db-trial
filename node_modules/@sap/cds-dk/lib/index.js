const cds = require('./cds')
const compile_desc = Reflect.getOwnPropertyDescriptor(cds,'compile')

// extending cds to lazy-load additional submodules provided by cds-dk
module.exports = Object.defineProperties (cds, {

  import: {enumerable:true, get:()=> require('./import/importapi')},

  compile: {enumerable:true, get:()=> {
    // lazy-extending cds.compile.to only when cds.compile getter is invoked
    // otherwise we might cause cds.env being invoked too early.
    const compile = compile_desc.value || compile_desc.get.call(cds)
    if (!Reflect.getOwnPropertyDescriptor(compile.to, 'openapi'))
      Object.defineProperties (compile.to, {
        openapi: {enumerable:true, get:()=> require('./compile/openapi')}
      })
    return compile
  }},
})

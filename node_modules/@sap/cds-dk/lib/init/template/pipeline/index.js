const { join } = require('path');
const { exists } = require('../../../cds').utils
const { copyFiles } = require('../../util/templateUtil')
const { URLS } = require('../../constants')
const LOG = console

module.exports = class PipelineTemplate extends require('../templateBase') {
    constructor(projectPath, generator) {
        super(projectPath, generator, __dirname);
    }

    async canRun() {
        if (this.options.force) {
            return true;
        }

        if (exists(join(this.projectPath, 'Jenkinsfile')) ||
            exists(join(this.projectPath, '.pipeline/config.yml'))) {
            throw new Error(`Pipeline support file exists. Use --force to overwrite.`);
        }

        return true;
    }

    async run() {
        await copyFiles(join(__dirname, 'files'), this.projectPath, {}, this.options.force);
    }

    async finalize() {
        LOG.info(`For information on project "Piper" and its pipelines see ${URLS.PIPELINE_HELP}`);
    }
}
